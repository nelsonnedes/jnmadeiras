<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JN Madeiras - √Årea Administrativa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #2c1810;
            color: white;
            border-radius: 8px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .menu {
            position: absolute;
            right: 20px;
            top: 20px;
        }

        .menu-button {
            background-color: #4a3228;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 10px;
        }

        .menu-button:hover {
            background-color: #5f422f;
        }

        .promo-section {
            background: linear-gradient(135deg, #2c1810 0%, #4a3228 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: white;
        }

        .promo-section textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 1em;
            resize: vertical;
        }

        .promo-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #fff;
        }

        .wood-table {
            width: 100%;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-collapse: collapse;
            margin-bottom: 20px;
            overflow-x: auto;
            display: block;
        }

        .wood-table th,
        .wood-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            min-width: 120px;
        }

        .wood-table th {
            background-color: #4a3228;
            color: white;
            white-space: nowrap;
        }

        .wood-table tr:hover {
            background-color: #f9f9f9;
        }

        .wood-table input[type="text"],
        .wood-table input[type="number"] {
            width: 120px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .wood-table input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .wood-table input[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .action-button {
            padding: 15px 30px;
            background-color: #2c1810;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s;
        }

        .action-button:hover {
            background-color: #4a3228;
        }

        .delete-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .delete-button:hover {
            background-color: #c82333;
        }

        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            background-color: #2c1810;
            color: white;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .menu-icon {
            font-size: 24px;
            cursor: pointer;
            color: white;
            background: none;
            border: none;
            padding: 10px;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
        }

        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            min-width: 18px;
            text-align: center;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background-color: #2c1810;
            padding: 20px;
            transition: left 0.3s ease;
            z-index: 1000;
            color: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h3 {
            margin: 0;
            font-size: 1.5em;
            color: white;
        }

        .close-sidebar {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .sidebar-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sidebar-content a {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .sidebar-content a:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .sidebar-content a i {
            width: 20px;
            text-align: center;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            transition: opacity 0.3s;
        }

        .overlay.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
        }

        .modal-content {
            position: relative;
            background-color: white;
            margin: 50px auto;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            cursor: move;
            padding: 10px;
            background-color: #2c1810;
            color: white;
            border-radius: 12px 12px 0 0;
            margin: -30px -30px 20px -30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .modal-header h2 {
            margin: 0;
            padding: 0 20px;
            border: none;
            color: white !important;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: center;
        }

        .modal-header h2 i {
            color: #4a3228;
        }

        .modal-header .close-modal {
            color: white;
            padding: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            position: absolute;
            right: 10px;
        }

        .modal-content h2 {
            color: #2c1810;
            text-align: center;
            margin-bottom: 25px;
            font-size: 24px;
            border-bottom: 2px solid #2c1810;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .modal-content h2 i {
            color: #4a3228;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c1810;
            font-weight: bold;
            font-size: 0.95em;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            border-color: #2c1810;
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 24, 16, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .submit-button, .cancel-button {
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .submit-button {
            background-color: #2c1810;
            color: white;
            border: none;
        }

        .submit-button:hover {
            background-color: #4a3228;
            transform: translateY(-2px);
        }

        .cancel-button {
            background-color: #6c757d;
            color: white;
            border: none;
        }

        .cancel-button:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        .password-requirements {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9em;
            color: #666;
        }

        .password-requirements h4 {
            color: #2c1810;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .password-requirements ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .password-requirements li {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .password-requirements li i {
            color: #2c1810;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
        }

        .company-settings {
            padding: 20px;
        }

        .company-settings .form-group {
            margin-bottom: 20px;
        }

        .company-settings label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .company-settings input,
        .company-settings textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .company-logo-preview {
            max-width: 200px;
            margin: 10px 0;
        }

        .quote-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .quote-list th,
        .quote-list td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .quote-list th {
            background-color: #4a3228;
            color: white;
        }

        .quote-list tr:hover {
            background-color: #f5f5f5;
        }

        .action-buttons button {
            padding: 5px 10px;
            margin: 0 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .view-button {
            background-color: #2c1810;
            color: white;
        }

        .respond-button {
            background-color: #28a745;
            color: white;
        }

        .edit-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .edit-button:hover {
            background-color: #218838;
        }

        #editQuoteForm {
            overflow-y: auto;
            max-height: calc(90vh - 100px);
            padding-right: 10px;
        }

        #editQuoteForm::-webkit-scrollbar {
            width: 8px;
        }

        #editQuoteForm::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        #editQuoteForm::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        #editQuoteForm::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .pdf-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .pdf-button:hover {
            background-color: #c82333;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="admin-header">
            <button class="menu-icon" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <h1>JN Madeiras</h1>
            <div class="notification-bell" onclick="showQuotes()">
                <i class="fas fa-bell"></i>
                <span class="notification-count" id="notificationCount">0</span>
            </div>
        </div>

        <div class="promo-section">
            <label for="promoText">Ofertas e Promo√ß√µes:</label>
            <textarea id="promoText" placeholder="Digite aqui as ofertas e promo√ß√µes especiais..." onchange="updatePromoText(this.value)"></textarea>
        </div>

        <table class="wood-table">
            <thead>
                <tr>
                    <th>Esp√©cie</th>
                    <th>Quantidade em Tora (m¬≥)</th>
                    <th>Rendimento (%)</th>
                    <th>Quantidade Serrada (m¬≥)</th>
                    <th>Pre√ßo (R$)</th>
                    <th>Exibir</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="woodTableBody">
            </tbody>
        </table>

        <div class="button-container">
            <button class="action-button" onclick="adicionarItem()">Adicionar Novo Item</button>
            <button class="action-button" onclick="salvarAlteracoes()">Salvar Altera√ß√µes</button>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>Menu</h3>
            <button class="close-sidebar" onclick="toggleSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-content">
            <a href="#" onclick="showCompanySettings()">
                <i class="fas fa-building"></i> Configura√ß√µes da Empresa
            </a>
            <a href="orcamento.html" onclick="showQuotes()"> 
                <i class="fas fa-file-invoice-dollar"></i> Or√ßamentos
            </a>
            <a href="#" onclick="showChangePassword()">
                <i class="fas fa-key"></i> Alterar Senha
            </a>
            <a href="index.html">
                <i class="fas fa-home"></i> Voltar para Home
            </a>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Modal de Configura√ß√µes da Empresa -->
    <div class="modal" id="companySettingsModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('companySettingsModal')">&times;</button>
            <h2>Configura√ß√µes da Empresa</h2>
            <div class="company-settings">
                <form id="companySettingsForm" onsubmit="saveCompanySettings(event)">
                    <div class="form-group">
                        <label for="companyLogo">Logo da Empresa:</label>
                        <input type="file" id="companyLogo" accept="image/*" onchange="previewLogo(event)">
                        <img id="logoPreview" class="company-logo-preview" style="display: none;">
                    </div>
                    <div class="form-group">
                        <label for="companyName">Nome da Empresa:</label>
                        <input type="text" id="companyName" required>
                    </div>
                    <div class="form-group">
                        <label for="companyAddress">Endere√ßo:</label>
                        <textarea id="companyAddress" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="companyPhone">Telefone:</label>
                        <input type="tel" id="companyPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="companyEmail">E-mail:</label>
                        <input type="email" id="companyEmail" required>
                    </div>
                    <button type="submit" class="action-button">Salvar Configura√ß√µes</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Or√ßamentos -->
    <div class="modal" id="quotesModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('quotesModal')">&times;</button>
            <h2>Or√ßamentos Recebidos</h2>
            <table class="quote-list">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Cliente</th>
                        <th>Cidade/Estado</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="quotesList">
                    <!-- Preenchido via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal de Visualiza√ß√£o/Resposta de Or√ßamento -->
    <div class="modal" id="quoteDetailModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('quoteDetailModal')">&times;</button>
            <h2>Detalhes do Or√ßamento</h2>
            <div id="quoteDetail">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal de Alterar Senha -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-key"></i> Alterar Senha</h2>
            <div class="form-group">
                <label for="currentPassword">Senha Atual:</label>
                <input type="password" id="currentPassword" required placeholder="Digite sua senha atual">
            </div>
            <div class="form-group">
                <label for="newPassword">Nova Senha:</label>
                <input type="password" id="newPassword" required placeholder="Digite a nova senha">
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirmar Nova Senha:</label>
                <input type="password" id="confirmPassword" required placeholder="Confirme a nova senha">
            </div>
            <div class="password-requirements">
                <h4>Requisitos da Senha:</h4>
                <ul>
                    <li><i class="fas fa-check-circle"></i> M√≠nimo de 8 caracteres</li>
                    <li><i class="fas fa-check-circle"></i> Deve conter letras e n√∫meros</li>
                    <li><i class="fas fa-check-circle"></i> Evite usar caracteres especiais</li>
                </ul>
            </div>
            <div class="modal-buttons">
                <button onclick="changePassword()" class="submit-button">
                    <i class="fas fa-save"></i> Salvar
                </button>
                <button onclick="closeChangePasswordModal()" class="cancel-button">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Or√ßamento -->
    <div class="modal" id="editQuoteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Or√ßamento</h2>
                <button class="close-modal" onclick="closeModal('editQuoteModal')">&times;</button>
            </div>
            <form id="editQuoteForm" onsubmit="saveChanges()">
                <div class="form-group">
                    <label for="editNome">Nome do Cliente:</label>
                    <input type="text" id="editNome" required>
                </div>
                <div class="form-group">
                    <label for="editTelefone">Telefone:</label>
                    <input type="tel" id="editTelefone" required>
                </div>
                <div class="form-group">
                    <label for="editEstado">Estado:</label>
                    <input type="text" id="editEstado" required maxlength="2">
                </div>
                <div class="form-group">
                    <label for="editCidade">Cidade:</label>
                    <input type="text" id="editCidade" required>
                </div>
                <div class="form-group">
                    <label>Esp√©cies de Madeira:</label>
                    <div id="editEspecies" class="species-grid">
                        <!-- As esp√©cies ser√£o carregadas aqui via JavaScript -->
                    </div>
                    <input type="hidden" id="editSelectedSpecies" name="editSelectedSpecies">
                </div>
                <div class="form-group">
                    <label for="editPedido">Detalhes do Pedido:</label>
                    <textarea id="editPedido" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editObservacoes">Observa√ß√µes:</label>
                    <textarea id="editObservacoes"></textarea>
                </div>
                <div class="form-group">
                    <label for="editContraProposta">Contra Proposta:</label>
                    <textarea id="editContraProposta" placeholder="Digite aqui sua contra proposta..."></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="submit-button">
                        <i class="fas fa-save"></i> Salvar
                    </button>
                    <button type="button" class="pdf-button" onclick="generateAndSendPDF(event)">
                        <i class="fas fa-file-pdf"></i> Gerar PDF e Enviar
                    </button>
                    <button type="button" class="cancel-button" onclick="closeModal('editQuoteModal')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let woodData = [];
        let promoText = '';
        let currentEditingQuoteIndex = -1;

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        function formatVolume(value) {
            return new Intl.NumberFormat('pt-BR', {
                minimumFractionDigits: 3,
                maximumFractionDigits: 3
            }).format(value) + ' m¬≥';
        }

        function unformatNumber(value) {
            return parseFloat(value.replace(/[^\d,.-]/g, '').replace(',', '.'));
        }

        function loadWoodData() {
            const savedData = localStorage.getItem('woodData');
            const savedPromo = localStorage.getItem('promoText');
            
            if (savedData) {
                woodData = JSON.parse(savedData);
            } else {
                woodData = [
                    { 
                        name: "Angelim Vermelho", 
                        price: 95000, 
                        visible: true,
                        quantidadeTora: 95.000,
                        porcentagem: 50,
                        quantidadeSerrada: 47.500
                    },
                    { name: "Angelim-Amargoso", price: 225.4383, visible: true },
                    { name: "Angelim-Pedra", price: 93.0246, visible: true },
                    { name: "Araracanga", price: 20.770, visible: true },
                    { name: "Cumaru Vermelho", price: 15.000, visible: true },
                    { name: "Fava-Orelha-de-Macaco", price: 117.888, visible: true },
                    { name: "Guari√∫ba", price: 3.236, visible: true },
                    { name: "Jatob√°", price: 134.928, visible: true },
                    { name: "Louro Tamaguare", price: 45.000, visible: true },
                    { name: "Mandioqueiro", price: 15.000, visible: true },
                    { name: "Ma√ßaranduba", price: 16.054, visible: true },
                    { name: "Oiticica", price: 24.713, visible: true },
                    { name: "Orelha de Macaco", price: 21.502, visible: true },
                    { name: "Pequi√°", price: 78.672, visible: true },
                    { name: "Quaruba-Cedro", price: 42.173, visible: true },
                    { name: "Quarubatinga", price: 80.629, visible: true },
                    { name: "Tanibuca", price: 62.714, visible: true },
                    { name: "T√°xi", price: 75.000, visible: true },
                    { name: "Timborana", price: 35.000, visible: true }
                ];
            }

            if (savedPromo) {
                promoText = savedPromo;
                document.getElementById('promoText').value = promoText;
            }

            renderTable();
        }

        function calculateSerrada(tora, porcentagem) {
            return (tora * porcentagem) / 100;
        }

        function renderTable() {
            const tbody = document.getElementById('woodTableBody');
            tbody.innerHTML = '';

            woodData.forEach((wood, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <input type="text" 
                               value="${wood.name}"
                               onchange="updateName(${index}, this.value)">
                    </td>
                    <td>
                        <input type="text" 
                               value="${formatVolume(wood.quantidadeTora)}"
                               onchange="updateTora(${index}, this.value)">
                    </td>
                    <td>
                        <input type="number" 
                               min="0" 
                               max="100" 
                               value="${wood.porcentagem}" 
                               onchange="updatePorcentagem(${index}, this.value)">
                    </td>
                    <td>
                        <input type="text" 
                               value="${formatVolume(wood.quantidadeSerrada)}"
                               readonly>
                    </td>
                    <td>
                        <input type="text" 
                               value="${formatCurrency(wood.price)}"
                               onchange="updatePrice(${index}, this.value)">
                    </td>
                    <td>
                        <input type="checkbox" 
                               ${wood.visible ? 'checked' : ''} 
                               onchange="updateVisibility(${index}, this.checked)">
                    </td>
                    <td>
                        <button class="delete-button" onclick="excluirItem(${index})">Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateName(index, value) {
            woodData[index].name = value;
        }

        function updateTora(index, value) {
            const quantidade = unformatNumber(value);
            woodData[index].quantidadeTora = quantidade;
            woodData[index].quantidadeSerrada = calculateSerrada(
                woodData[index].quantidadeTora,
                woodData[index].porcentagem
            );
            renderTable();
        }

        function updatePorcentagem(index, value) {
            woodData[index].porcentagem = parseFloat(value);
            woodData[index].quantidadeSerrada = calculateSerrada(
                woodData[index].quantidadeTora,
                woodData[index].porcentagem
            );
            renderTable();
        }

        function updatePrice(index, value) {
            woodData[index].price = unformatNumber(value);
            renderTable();
        }

        function updateVisibility(index, visible) {
            woodData[index].visible = visible;
        }

        function excluirItem(index) {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                woodData.splice(index, 1);
                renderTable();
            }
        }

        function adicionarItem() {
            woodData.push({
                name: "Nova Esp√©cie",
                price: 0,
                visible: true,
                quantidadeTora: 0,
                porcentagem: 50,
                quantidadeSerrada: 0
            });
            renderTable();
        }

        function updatePromoText(value) {
            promoText = value;
            localStorage.setItem('promoText', value);
        }

        function salvarAlteracoes() {
            localStorage.setItem('woodData', JSON.stringify(woodData));
            localStorage.setItem('promoText', promoText);
            alert('Altera√ß√µes salvas com sucesso!');
        }

        // Fun√ß√µes do Menu Lateral
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }

        // Fun√ß√µes dos Modais
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
            
            // Resetar a posi√ß√£o do modal
            const modalContent = modal.querySelector('.modal-content');
            modalContent.style.transform = 'translate3d(0px, 0px, 0)';
            
            // Tornar o modal arrast√°vel se for o modal de edi√ß√£o
            if (modalId === 'editQuoteModal') {
                makeDraggable(modalId);
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            
            // Resetar a posi√ß√£o do modal
            const modalContent = modal.querySelector('.modal-content');
            modalContent.style.transform = 'translate3d(0px, 0px, 0)';
        }

        function showCompanySettings() {
            toggleSidebar();
            showModal('companySettingsModal');
            loadCompanySettings();
        }

        function showQuotes() {
            showModal('quotesModal');
            loadQuotes();
            // Resetar contador de notifica√ß√µes
            localStorage.setItem('notificacoes', '0');
            updateNotificationCount();
        }

        // Fun√ß√µes de Configura√ß√µes da Empresa
        function previewLogo(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('logoPreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    localStorage.setItem('companyLogo', e.target.result);
                }
                reader.readAsDataURL(file);
            }
        }

        function saveCompanySettings(event) {
            event.preventDefault();
            
            const settings = {
                name: document.getElementById('companyName').value,
                address: document.getElementById('companyAddress').value,
                phone: document.getElementById('companyPhone').value,
                email: document.getElementById('companyEmail').value,
                logo: document.getElementById('logoPreview').src
            };
            
            localStorage.setItem('companySettings', JSON.stringify(settings));
            alert('Configura√ß√µes salvas com sucesso!');
            closeModal('companySettingsModal');
        }

        function loadCompanySettings() {
            const settings = JSON.parse(localStorage.getItem('companySettings') || '{}');
            
            if (settings.logo) {
                document.getElementById('logoPreview').src = settings.logo;
                document.getElementById('logoPreview').style.display = 'block';
            }
            
            document.getElementById('companyName').value = settings.name || '';
            document.getElementById('companyAddress').value = settings.address || '';
            document.getElementById('companyPhone').value = settings.phone || '';
            document.getElementById('companyEmail').value = settings.email || '';
        }

        // Fun√ß√µes de Or√ßamentos
        function loadQuotes() {
            const quotes = JSON.parse(localStorage.getItem('orcamentos') || '[]');
            const tbody = document.getElementById('quotesList');
            tbody.innerHTML = '';
            
            quotes.forEach((quote, index) => {
                const tr = document.createElement('tr');
                const date = new Date(quote.data).toLocaleDateString('pt-BR');
                
                tr.innerHTML = `
                    <td>${date}</td>
                    <td>${quote.nome}</td>
                    <td>${quote.cidade}/${quote.estado}</td>
                    <td>${quote.status}</td>
                    <td class="action-buttons">
                        <button class="view-button" onclick="viewQuote(${index})">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="edit-button" onclick="editQuote(${index})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function viewQuote(index) {
            const quotes = JSON.parse(localStorage.getItem('orcamentos') || '[]');
            const quote = quotes[index];
            const detail = document.getElementById('quoteDetail');
            
            detail.innerHTML = `
                <div style="padding: 20px;">
                    <h3>Informa√ß√µes do Cliente</h3>
                    <p><strong>Nome:</strong> ${quote.nome}</p>
                    <p><strong>Telefone:</strong> ${quote.telefone}</p>
                    <p><strong>Localiza√ß√£o:</strong> ${quote.cidade}/${quote.estado}</p>
                    
                    <h3>Esp√©cies de Interesse</h3>
                    <div style="margin: 10px 0;">
                        ${quote.especies.map(especie => `
                            <span style="display: inline-block; background: #f0f0f0; padding: 5px 10px; margin: 5px; border-radius: 4px;">
                                ${especie}
                            </span>
                        `).join('')}
                    </div>
                    
                    <h3>Detalhes do Pedido</h3>
                    <p><strong>Pedido:</strong></p>
                    <pre style="white-space: pre-wrap;">${quote.pedido}</pre>
                    
                    <h3>Observa√ß√µes</h3>
                    <pre style="white-space: pre-wrap;">${quote.observacoes || 'Nenhuma observa√ß√£o'}</pre>
                </div>
            `;
            
            showModal('quoteDetailModal');
        }

        function editQuote(index) {
            const quotes = JSON.parse(localStorage.getItem('orcamentos') || '[]');
            const quote = quotes[index];
            currentEditingQuoteIndex = index;

            // Preencher o formul√°rio com os dados do or√ßamento
            document.getElementById('editNome').value = quote.nome;
            document.getElementById('editTelefone').value = quote.telefone;
            document.getElementById('editEstado').value = quote.estado;
            document.getElementById('editCidade').value = quote.cidade;
            document.getElementById('editPedido').value = quote.pedido;
            document.getElementById('editObservacoes').value = quote.observacoes || '';
            document.getElementById('editContraProposta').value = quote.contraProposta || '';

            // Preencher as esp√©cies
            const especiesDiv = document.getElementById('editEspecies');
            especiesDiv.innerHTML = '';
            quote.especies.forEach(especie => {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = especie;
                checkbox.checked = true;
                checkbox.id = `edit_${especie}`;
                
                const label = document.createElement('label');
                label.htmlFor = `edit_${especie}`;
                label.textContent = especie;
                
                const div = document.createElement('div');
                div.appendChild(checkbox);
                div.appendChild(label);
                especiesDiv.appendChild(div);
            });

            showModal('editQuoteModal');
        }

        function saveChanges() {
            const form = document.getElementById('editQuoteForm');
            const orcamentoId = form.dataset.orcamentoId;
            
            // Obter as esp√©cies selecionadas com seus pre√ßos
            const selectedSpecies = Array.from(document.querySelectorAll('#editQuoteForm input[name="editSpecies"]:checked'))
                .map(cb => {
                    const price = cb.parentElement.querySelector('.price').textContent;
                    return `${cb.value} - ${price}`;
                });
            
            // Atualizar o or√ßamento no localStorage
            let orcamentos = JSON.parse(localStorage.getItem('orcamentos') || '[]');
            const index = orcamentos.findIndex(o => o.id === orcamentoId);
            
            if (index !== -1) {
                orcamentos[index] = {
                    ...orcamentos[index],
                    nome: form.querySelector('#editNome').value,
                    telefone: form.querySelector('#editTelefone').value,
                    estado: form.querySelector('#editEstado').value,
                    cidade: form.querySelector('#editCidade').value,
                    especies: selectedSpecies,
                    pedido: form.querySelector('#editPedido').value,
                    observacoes: form.querySelector('#editObservacoes').value,
                    data: new Date().toISOString()
                };
                
                localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
                alert('Or√ßamento atualizado com sucesso!');
                closeModal('editQuoteModal');
                loadQuotes();
            }
        }

        function generateAndSendPDF(event) {
            if (event) {
                event.preventDefault();
            }
            
            try {
                const quotes = JSON.parse(localStorage.getItem('orcamentos') || '[]');
                const quote = quotes[currentEditingQuoteIndex];
                const settings = JSON.parse(localStorage.getItem('companySettings') || '{}');
                
                // Criar uma nova inst√¢ncia do jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Adicionar logo da empresa (se existir)
                if (settings.logo) {
                    const img = new Image();
                    img.src = settings.logo;
                    doc.addImage(img, 'PNG', 20, 20, 40, 40);
                }
                
                // Informa√ß√µes da Empresa (alinhadas √† direita)
                doc.setFontSize(14);
                doc.text(settings.name || 'JN MADEIRAS', 170, 25, { align: 'right' });
                doc.setFontSize(12);
                doc.text(settings.address || 'TRAVESSA DOMINGOS MIRANDA CARNEIRO', 170, 40, { align: 'right' });
                doc.text(settings.phone || '91991311049', 170, 55, { align: 'right' });
                doc.text(settings.email || 'jnmadeirasm@hotmail.com', 170, 70, { align: 'right' });
                
                // T√≠tulo do Or√ßamento
                doc.setFontSize(20);
                doc.text('Or√ßamento', 105, 90, { align: 'center' });
                
                // Informa√ß√µes do Cliente
                doc.setFontSize(14);
                doc.text('Dados do Cliente', 20, 100);
                doc.setFontSize(12);
                doc.text(`Nome: ${quote.nome}`, 20, 110);
                doc.text(`Telefone: ${quote.telefone}`, 20, 120);
                doc.text(`Localiza√ß√£o: ${quote.cidade}/${quote.estado}`, 20, 130);
                
                // Esp√©cies de Interesse
                doc.setFontSize(14);
                doc.text('Esp√©cies de Interesse', 20, 150);
                doc.setFontSize(12);
                let y = 160;
                quote.especies.forEach(especie => {
                    doc.text(`‚Ä¢ ${especie}`, 20, y);
                    y += 10;
                });
                
                // Detalhes do Pedido
                doc.setFontSize(14);
                doc.text('Detalhes do Pedido', 20, y + 10);
                doc.setFontSize(12);
                const pedidoLines = doc.splitTextToSize(quote.pedido, 170);
                doc.text(pedidoLines, 20, y + 20);
                
                // Contra Proposta
                if (quote.contraProposta) {
                    doc.setFontSize(14);
                    doc.text('Contra Proposta', 20, y + 40);
                    doc.setFontSize(12);
                    const contraPropostaLines = doc.splitTextToSize(quote.contraProposta, 170);
                    doc.text(contraPropostaLines, 20, y + 50);
                }
                
                // Data do Or√ßamento
                const data = new Date().toLocaleDateString('pt-BR');
                doc.setFontSize(10);
                doc.text(`Data: ${data}`, 20, 280);
                
                // Salvar o PDF
                doc.save(`orcamento_${quote.nome.replace(/\s+/g, '_')}.pdf`);
                
                // Abrir WhatsApp com o PDF
                const phone = quote.telefone.replace(/\D/g, '');
                const message = encodeURIComponent(`Ol√° ${quote.nome}, segue nossa contra proposta para seu or√ßamento.`);
                
                // Atualizar status
                quotes[currentEditingQuoteIndex].status = 'Respondido';
                localStorage.setItem('orcamentos', JSON.stringify(quotes));
                loadQuotes();
                
                // Fechar o modal
                closeModal('editQuoteModal');
                
                // Abrir WhatsApp
                window.open(`https://wa.me/55${phone}?text=${message}`, '_blank');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Ocorreu um erro ao gerar o PDF. Por favor, tente novamente.');
            }
        }

        function updateNotificationCount() {
            const count = parseInt(localStorage.getItem('notificacoes') || '0');
            const countElement = document.getElementById('notificationCount');
            countElement.textContent = count;
            countElement.style.display = count > 0 ? 'block' : 'none';
        }

        function showChangePassword() {
            closeSidebar();
            const modal = document.getElementById('changePasswordModal');
            modal.style.display = 'block';
        }

        function closeChangePasswordModal() {
            const modal = document.getElementById('changePasswordModal');
            modal.style.display = 'none';
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (currentPassword !== '20292029') {
                alert('Senha atual incorreta!');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('As senhas n√£o coincidem!');
                return;
            }

            if (newPassword.length < 8) {
                alert('A nova senha deve ter pelo menos 8 caracteres!');
                return;
            }

            // Aqui voc√™ pode implementar a l√≥gica para salvar a nova senha
            alert('Senha alterada com sucesso!');
            closeChangePasswordModal();
        }

        // Fun√ß√£o para tornar o modal arrast√°vel
        function makeDraggable(modalId) {
            const modal = document.getElementById(modalId);
            const modalContent = modal.querySelector('.modal-content');
            const modalHeader = modal.querySelector('.modal-header');
            
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            modalHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            function dragStart(e) {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;

                if (e.target === modalHeader || e.target.parentNode === modalHeader) {
                    isDragging = true;
                }
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;

                    xOffset = currentX;
                    yOffset = currentY;

                    setTranslate(currentX, currentY, modalContent);
                }
            }

            function dragEnd() {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
            }

            function setTranslate(xPos, yPos, el) {
                el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            loadWoodData();
            updateNotificationCount();
            // Verificar novas notifica√ß√µes a cada minuto
            setInterval(updateNotificationCount, 60000);
        });

        function openEditModal(orcamento) {
            const modal = document.getElementById('editQuoteModal');
            const form = document.getElementById('editQuoteForm');
            
            // Preencher o formul√°rio com os dados do or√ßamento
            form.querySelector('#editNome').value = orcamento.nome;
            form.querySelector('#editTelefone').value = orcamento.telefone;
            form.querySelector('#editEstado').value = orcamento.estado;
            form.querySelector('#editCidade').value = orcamento.cidade;
            form.querySelector('#editPedido').value = orcamento.pedido;
            form.querySelector('#editObservacoes').value = orcamento.observacoes || '';
            
            // Preencher as esp√©cies selecionadas
            const speciesGrid = form.querySelector('#editEspecies');
            speciesGrid.innerHTML = '';
            
            // Carregar todas as esp√©cies dispon√≠veis
            const woodData = JSON.parse(localStorage.getItem('woodData') || '[]');
            
            // Criar um mapa de esp√©cies selecionadas para f√°cil acesso
            const selectedSpeciesMap = new Map(
                orcamento.especies.map(species => {
                    const [name, price] = species.split(' - ');
                    return [name, price];
                })
            );
            
            woodData.forEach(wood => {
                if (wood.visible) {
                    const div = document.createElement('div');
                    div.className = 'species-item';
                    
                    // Verificar se esta esp√©cie est√° selecionada
                    const isSelected = selectedSpeciesMap.has(wood.name);
                    const price = isSelected ? selectedSpeciesMap.get(wood.name) : formatCurrency(wood.price);
                    
                    div.innerHTML = `
                        <input type="checkbox" 
                               name="editSpecies" 
                               value="${wood.name}"
                               id="edit_${wood.name}"
                               ${isSelected ? 'checked' : ''}
                               onchange="updateEditSpeciesSelection(this)">
                        <label for="edit_${wood.name}">
                            ${wood.name}
                            <span class="price">${price}</span>
                        </label>
                    `;
                    speciesGrid.appendChild(div);
                }
            });
            
            // Armazenar o ID do or√ßamento para refer√™ncia
            form.dataset.orcamentoId = orcamento.id;
            
            modal.style.display = 'block';
        }

        function updateEditSpeciesSelection(checkbox) {
            const selectedSpecies = Array.from(document.querySelectorAll('#editQuoteForm input[name="editSpecies"]:checked'))
                .map(cb => {
                    const price = cb.parentElement.querySelector('.price').textContent;
                    return `${cb.value} - ${price}`;
                });
            
            // Atualizar o campo de esp√©cies selecionadas
            document.getElementById('editSelectedSpecies').value = selectedSpecies.join('\n');
        }
    </script>
</body>
</html> 